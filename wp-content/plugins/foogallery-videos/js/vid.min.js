/*!
* Vid - A simple utility method for retrieving video information.
* @version 0.0.1
* @link https://bitbucket.org/fooplugins/vid
* @copyright FooPlugins 2016
* @license Released under the GPLv3 license.
*/
!function(a){a.vid=function(b,c){return(b instanceof a.vid.Video?b:new a.vid.Video(b,c)).fetch()},a.vid.defaults={autoPlay:!1,youTubeKey:null,mimeTypes:{"video/mp4":/\.mp4/i,"video/webm":/\.webm/i,"video/wmv":/\.wmv/i,"video/ogg":/\.ogv/i},mimeTypeGroup:{custom:["video/mp4","video/wmv","video/ogg","video/webm"],ie:["video/mp4","video/wmv"],other:["video/mp4","video/ogg","video/webm"]}},a.vid.config=function(b){a.extend(!0,a.vid.defaults,b)},a.vid.registerMimeType=function(b,c){"string"==typeof b&&(c instanceof RegExp||"object"==typeof c&&c.regex instanceof RegExp)?a.vid.defaults.mimeTypes[b]=c:console.log("Failed to register mime type: ",b,c)}}(jQuery),function(a,b){b.Url=function(a){return this instanceof b.Url?(this.url="",this.base="",this.hash="",this.protocol="",this.params=[],void this.init(a)):new b.Url(a)},b.Url.prototype.init=function(a){if(!("string"!=typeof a||a.length<5)){this.url=a;var b=a.split("#");this.hash=2==b.length?"#"+b[1]:"",b=b[0].split("?"),this.base=b[0],this.protocol="https"==a.substring(0,5)?"https:":"http:",this.params=[];for(var c,d=(2==b.length?b[1]:"").split(/[&;]/g),e=0,f=d.length;f>e;e++)c=d[e].split("="),2==c.length&&this.param(decodeURIComponent(c[0]),decodeURIComponent(c[1]))}},b.Url.prototype.param=function(a,b){for(var c="undefined"==typeof b,d="string"==typeof b&&""===b,e=this.params.length;e-- >0;)if(this.params[e].key==a)return c?this.params[e].value:(d?this.params.splice(e,1):this.params[e].value=b,this);return c?null:(d||this.params.push({key:a,value:b}),this)},b.Url.prototype.toString=function(){for(var a=this.params.length>0?"?":"",b=0,c=this.params.length;c>b;b++)0!=b&&(a+="&"),a+=encodeURIComponent(this.params[b].key)+"="+encodeURIComponent(this.params[b].value);return this.base+a+this.hash}}(jQuery,jQuery.vid),function(a,b){b.Video=function(a,c){return this instanceof b.Video?(this.options={},this.url=null,this.id="",this.api="",this.mimeType="",this.mimeTypeOptions=null,this.custom=!1,this.supported=!1,this.fetched=!1,this.title="",this.credits="",this.thumb_small="",this.thumb_large="",void this.init(a,c)):new b.Video(a,c)},b.Video.prototype.init=function(c,d){if(this.url=new b.Url(c),""!==this.url.url){this.options=a.extend(!0,{},a.vid.defaults,d);var e=this.url.base.match(/.*\/(.*)$/);this.id=e&&e.length>=2?e[1]:null,this.parseMimeType(c);var f=navigator.userAgent.toLowerCase(),g=f.indexOf("msie ")>-1||f.indexOf("trident/")>-1||f.indexOf("edge/")>-1;this.custom=-1!==a.inArray(this.mimeType,this.options.mimeTypeGroup.custom),this.supported=-1!==a.inArray(this.mimeType,g?this.options.mimeTypeGroup.ie:this.options.mimeTypeGroup.other),this.mimeTypeOptions&&a.isFunction(this.mimeTypeOptions.init)&&this.mimeTypeOptions.init.call(this.mimeTypeOptions,this)}},b.Video.prototype.parseMimeType=function(a){for(var b in this.options.mimeTypes)if(this.options.mimeTypes.hasOwnProperty(b)){var c=this.options.mimeTypes[b],d=c instanceof RegExp?c:c.regex;d.test(a)&&(this.mimeType=b,this.mimeTypeOptions=c)}},b.Video.prototype.fetch=function(){var b=this;return a.Deferred(function(c){return b.fetched?void c.resolve(b):""===b.api||!b.mimeTypeOptions||!a.isFunction(b.mimeTypeOptions.parse)||a.isFunction(b.mimeTypeOptions.enabled)&&!b.mimeTypeOptions.enabled.call(b.mimeTypeOptions,b)?(b.fetched=!0,void c.reject(Error("No additional information can be retrieved for this video."),b)):void a.ajax({url:b.api,type:"GET",dataType:"jsonp"}).then(function(a){b.mimeTypeOptions.parse.call(b.mimeTypeOptions,a,b),b.fetched=!0,c.resolve(b)},function(a){b.fetched=!0,c.reject(a,b)})})}}(jQuery,jQuery.vid),function(a,b){b.registerMimeType("video/daily",{regex:/(www.)?dailymotion\.com|dai\.ly/i,init:function(a){a.id=/\/video\//i.test(a.url.base)?a.url.base.split(/\/video\//i)[1].split(/[?&]/)[0].split(/[_]/)[0]:a.url.url.split(/dai\.ly\//i)[1].split(/[?&]/)[0],a.embed=a.url.protocol+"//www.dailymotion.com/embed/video/"+a.id+"?wmode=opaque&info=0&logo=0&related=0"+(a.options.autoPlay?"&autoplay=1":""),a.api="https://www.dailymotion.com/services/oembed?url=https://dai.ly/"+a.id},parse:function(a,b){a.title&&a.author_name&&a.thumbnail_url&&(b.title=a.title,b.credits=a.author_name,b.thumb_small=a.thumbnail_url,b.thumb_large=a.thumbnail_url)}})}(jQuery,jQuery.vid),function(a,b){b.registerMimeType("video/vimeo",{regex:/(player.)?vimeo\.com/i,init:function(a){a.id=a.url.base.substr(a.url.base.lastIndexOf("/")+1),a.embed=a.url.protocol+"//player.vimeo.com/video/"+a.id+"?badge=0&portrait=0"+(a.options.autoPlay?"&autoplay=1":""),a.api="https://vimeo.com/api/v2/video/"+a.id+".json"},parse:function(a,b){a.length&&(b.title=a[0].title,b.credits=a[0].user_name,b.thumb_small=a[0].thumbnail_small,b.thumb_large=a[0].thumbnail_large)}})}(jQuery,jQuery.vid),function(a,b){b.registerMimeType("video/wistia",{regex:/(.+)?(wistia\.(com|net)|wi\.st)\/.*/i,init:function(a){a.id=/embed\//i.test(a.url.base)?a.url.base.split(/embed\/.*?\//i)[1].split(/[?&]/)[0]:a.url.base.split(/medias\//)[1].split(/[?&]/)[0];var b=/playlists\//i.test(a.url.base);a.embed=a.url.protocol+"//fast.wistia.net/embed/"+(b?"playlists":"iframe")+"/"+a.id+"?theme="+(a.options.autoPlay?b?"&media_0_0[autoPlay]=1":"$autoPlay=1":""),a.api="https://fast.wistia.net/oembed.json?url="+a.url.url},parse:function(b,c){if(b.title&&b.provider_name&&b.thumbnail_url){var d=new a.vid.Url(b.thumbnail_url);c.title=b.title,c.credits=b.provider_name,c.thumb_small=d.param("image_crop_resized","100x60").toString(),c.thumb_large=d.param("image_crop_resized","800x480").toString()}}})}(jQuery,jQuery.vid),function(a,b){b.registerMimeType("video/youtube",{regex:/(www.)?youtube|youtu\.be/i,enabled:function(a){return null!==a.options.youTubeKey},init:function(a){a.id=/embed\//i.test(a.url.base)?a.url.base.split(/embed\//i)[1].split(/[?&]/)[0]:a.url.url.split(/v\/|v=|youtu\.be\//i)[1].split(/[?&]/)[0],a.embed=a.url.protocol+"//www.youtube.com/embed/"+a.id+"?modestbranding=1&rel=0&wmode=transparent&showinfo=0"+(a.options.autoPlay?"&autoplay=1":""),a.api="https://www.googleapis.com/youtube/v3/videos?id="+a.id+"&fields=items(snippet(title,channelTitle,thumbnails))&part=snippet&key="+a.options.youTubeKey},parse:function(a,b){if(a.items&&a.items.length){var c=a.items[0].snippet;b.title=c.title,b.credits=c.channelTitle,b.thumb_small=this.thumb(c),b.thumb_large=this.thumb(c,!0)}},thumb_sizes:["default","medium","high","standard","maxres"],thumb:function(a,b){var c=JSON.parse(JSON.stringify(this.thumb_sizes)),d=a.thumbnails;b&&c.reverse();for(var e=0,f=c.length;f>e;e++)if(d.hasOwnProperty(c[e]))return d[c[e]].url;return""}})}(jQuery,jQuery.vid);